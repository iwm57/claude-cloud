# Claude Cloud - Self-healing development environment
# Usage: docker compose up -d
services:
  claude-cloud:
    build:
      context: .
      dockerfile: Dockerfile
    image: claude-cloud:latest
    container_name: claude-cloud

    # Keep container running
    restart: unless-stopped

    # Persistent volumes
    volumes:
      - claude-data:/root/.claude
      - workspace-context:/workspace/context

    # Environment variables (use .env file for sensitive values)
    environment:
      # GitHub token for gh CLI authentication
      - GITHUB_TOKEN=${GITHUB_TOKEN:-}
      # API key for kindly-web-search MCP server
      - SERPER_API_KEY=${SERPER_API_KEY:-}

    # Resource limits
    deploy:
      resources:
        limits:
          cpus: '1.0'
          memory: 1G
        reservations:
          memory: 256M

    # Health check
    healthcheck:
      test: ["CMD", "sh", "-c", "command -v claude"]
      interval: 30s
      timeout: 3s
      start_period: 5s
      retries: 3

    # Labels for Coolify
    labels:
      - "com.coolify.description=Claude Cloud Development Environment"
      - "com.coolify.type=development"

# Named volumes (auto-created by Docker)
volumes:
  claude-data:
    driver: local
  workspace-context:
    driver: local
